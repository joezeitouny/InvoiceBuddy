{% extends "base.html" %}
{% block content %}
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<div id="graph1"></div>
<div id="graph2"></div>
<div id="graph3"></div>
<div id="graph4"></div>
<div id="graph5"></div>

<script>
    function createGraph(graphData, elementId) {
        const data = JSON.parse(graphData);
        Plotly.newPlot(elementId, data.data, data.layout);
    }

    function refreshData() {
        $.ajax({
        url: '/get_stats',
            method: 'GET',
            dataType: 'json',
            success: function(data) {
                createGraph(data.fig1, 'graph1');
                createGraph(data.fig2, 'graph2');
                createGraph(data.fig3, 'graph3');
                createGraph(data.fig4, 'graph4');
                createGraph(data.fig5, 'graph5');

                // hide the loading modal
                $('#loading_modal').modal('hide');
            },
            error: function(error) {
                $('#loading_modal').modal('hide');
                notify_warning('Error while trying to get the stats! Reason: ' + error);
            }
        });
    }

    $(document).ready(function() {
        $('#loading_modal').modal('show');

        setTimeout(() => {
            refreshData();
        }, 500);
    });
</script>

{% endblock %}