{% extends "base.html" %}
{% block content %}

<div id="exit_trade_modal" tabindex="-1" class="modal fade" data-backdrop="static" xmlns="http://www.w3.org/1999/html">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Exit Trade?</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to exit the trade "<span id="exitTradeModalValue"></span>"?</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <button id="exitTradeActionButton" type="button" class="btn btn-primary">Yes</button>
            </div>
        </div>
    </div>
</div>

<div class="container p-0 mt-1">
    <div id="warning_notification" class="alert alert-warning ms-2 me-2 mb-0 text-danger" role="alert"
         style="display: none">
        <span><i class="bi bi-exclamation-triangle mb-2 me-2"></i><span id="warning_notification_message">This is the warning notification message placeholder</span></span>
    </div>
    <div id="success_notification" class="alert alert-success ms-2 me-2 mb-0" role="alert"
         style="display: none">
        <span><i class="bi bi-check-square mb-2 me-2"></i><span id="success_notification_message">This is the success notification message placeholder</span></span>
    </div>
</div>

<div class="container mt-4">
    <h2>Wallet</h2>
    <div class="table-responsive">
        <table class="table table-striped" id="wallet-data-table">
            <thead class="thead-light">
            <tr>
                <th scope="col">Asset</th>
                <th scope="col">Amount</th>
            </tr>
            </thead>
            <tbody>

            </tbody>
        </table>
    </div>
    <h4><span>Total Balance (in USD): <span id="wallet-balance-in-usd"></span> $</span></h4>
</div>

<div class="container mt-4">
    <div class="accordion" id="configuredRulesAccordion">
        <!-- Configured Rules -->
        <div class="card">
            <div class="card-header" id="headingConfiguredRules">
                <h2 class="mb-0">
                    <button class="btn btn-link" type="button" data-toggle="collapse"
                            data-target="#collapseConfiguredRules" aria-expanded="true"
                            aria-controls="collapseConfiguredRules">
                        Configured Rules (<span id="configured-rules-count"></span>)
                    </button>
                </h2>
            </div>
            <div id="collapseConfiguredRules" class="collapse" aria-labelledby="headingConfiguredRules"
                 data-parent="#configuredRulesAccordion">
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-striped" id="configured-rules-data-table">
                            <thead class="thead-light">
                            <tr>
                                <th scope="col">Rule ID</th>
                                <th scope="col">Rule Name</th>
                                <th scope="col">Symbol</th>
                                <th scope="col">Strategy</th>
                                <th scope="col">Interval</th>
                                <th scope="col">LONG3X Symbol</th>
                                <th scope="col">SHORT3X Symbol</th>
                                <th scope="col">FIAT Symbol to use</th>
                                <th scope="col">Balance % to use</th>
                                <th scope="col">Price Rounding Digits</th>
                                <th scope="col">Status</th>
                            </tr>
                            </thead>
                            <tbody>

                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="container mt-4">
    <h2>Active Trades (<span id="active-trades-count"></span>)</h2>
    <div class="table-responsive">
        <table class="table table-striped" id="active-trades-data-table">
            <thead class="thead-light">
            <tr>
                <th scope="col">Timestamp</th>
                <th scope="col">Rule ID</th>
                <th scope="col">Symbol</th>
                <th scope="col">Interval</th>
                <th scope="col">Strategy</th>
                <th scope="col">FIAT Symbol to use</th>
                <th scope="col">Entry Type</th>
                <th scope="col">Entry Price</th>
                <th scope="col">Quantity</th>
                <th scope="col">Amount</th>
                <th scope="col">P&L?</th>
                <th scope="col">Exit Trade</th>
            </tr>
            </thead>
            <tbody>

            </tbody>
            <tfoot style="border-top-width: thick;border-bottom-width: thick;">
            <tr>
                <td colspan="9"><b>Totals</b></td>
                <td><strong id="totalAmountTraded"></strong></td>
                <td><strong id="totalUnrealisedPAndL"></strong></td>
            </tr>
            </tfoot>
        </table>
    </div>
</div>

<div class="container mt-4">
    <h2>Rules Summary</h2>
    <div class="table-responsive">
        <table class="table table-striped" id="rules-summary-data-table">
            <thead class="thead-light">
            <tr>
                <th scope="col">Rule ID</th>
                <th scope="col">Rule Name</th>
                <th scope="col"># of Trades</th>
                <th scope="col"># of Profitable Trades</th>
                <th scope="col">Profitable Percentage</th>
                <th scope="col">Total P&L</th>
            </tr>
            </thead>
            <tbody>

            </tbody>
            <tfoot style="border-top-width: thick;border-bottom-width: thick;">
            <tr>
                <td colspan="2"><b>Totals</b></td>
                <td><strong id="totalNumberOfTrades"></strong></td>
                <td><strong id="totalNumberOfProfitableTrades"></strong></td>
                <td><strong id="profitablePercentage"></strong></td>
                <td><strong id="totalPAndL"></strong></td>
            </tr>
            </tfoot>
        </table>
    </div>
</div>

<script type="text/javascript">
first_refresh_data_call = true;

function refreshData() {
    if (first_refresh_data_call) {
        $('#loading_modal').modal('hide');
        first_refresh_data_call = false;
    }
<!--    $.ajax({-->
<!--        type: 'GET',-->
<!--        url: '/data',-->
<!--        success: function(data) {            -->
<!--            if (first_refresh_data_call) {-->
<!--                $('#loading_modal').modal('hide');-->
<!--                first_refresh_data_call = false;-->
<!--            }-->
<!--        },-->
<!--        error: function (error) {-->
<!--            if (first_refresh_data_call) {-->
<!--                $('#loading_modal').modal('hide');-->
<!--                first_refresh_data_call = false;-->
<!--            }-->

<!--            if (!connection_lost_dialog_shown) {-->
<!--                notify_warning('Error refreshing data: ' + error);-->
<!--            }-->
<!--        }-->
<!--    });-->
}

$(document).ready(function() {
    $('#loading_modal').modal('show');

    // Call the refreshData function every 1 seconds
    setInterval(refreshData, 1000);
});

function notify_success(message) {
    $('#success_notification_message').html(message);
    $("#success_notification").fadeIn();
    setTimeout(function () {
        $("#success_notification").fadeOut();
    }, 5000);
}

function notify_warning(message) {
    $('#warning_notification_message').html(message);
    $("#warning_notification").fadeIn();
    setTimeout(function () {
        $("#warning_notification").fadeOut();
    }, 5000);
}




</script>

{% endblock %}